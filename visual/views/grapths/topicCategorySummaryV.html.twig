<style>

    .v_chart rect {
        fill: steelblue;
    }

    .v_chart text {
        fill: auto;
        font: 10px sans-serif;
        text-anchor: middle;
    }

    .axis text {
        font: 10px sans-serif;
    }

    .axis path,
    .axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
    }

</style>
<h4 id="v_topicHeader"></h4>
<svg id="v_dataPlaceholder" class="v_chart"> Data loading, please wait ... </svg>
<script type="text/javascript">
    $(document).ready(function () {
      var dataUrl = "{{dataUrl}}";
      $.ajax({
        url: dataUrl,
        type: "GET",
        success: function (data) {
          $('#v_topicHeader').html(data.Header.Topic);
          $('#v_dataPlaceholder').html("");
          $('#v_dataPlaceholder').height(250);
          basicVBarChart.initialise(data.Data, '#v_dataPlaceholder');
        },
        error: function (xhr, ajaxOptions, thrownError) {
          $('#v_dataPlaceholder').html("error: " + thrownError);
        },
        complete: function () {

        }
      });
    });

    var basicVBarChart = {
      initialise: function (data, chartSvgSelector) {
        var parent = this;
        parent._setWidth(chartSvgSelector);
        parent.draw(data, chartSvgSelector);
        $(window).resize(function () {
          parent._setWidth(chartSvgSelector);

          d3.select(chartSvgSelector)
            .selectAll("g")
            .remove();
          $(chartSvgSelector).empty();
          parent.draw(data, chartSvgSelector);
        });
      },
      _setWidth: function (chartSvgSelector) {
        $(chartSvgSelector).width($(chartSvgSelector).parent().width() - 10);
      },
      draw: function (data, chartSvgSelector) {
        // Code developed following this tutorial: https://bost.ocks.org/mike/bar/3/
        var margin = {top: 20, right: 30, bottom: 30, left: 40};
        var width = $(chartSvgSelector).width() - margin.left - margin.right;
        var height = $(chartSvgSelector).height() - margin.top - margin.bottom;

        var x = d3.scale.ordinal()
          .rangeRoundBands([0, width], .1)
          .domain(data.map(function (item) {
            return item.Category;
          }));

        var y = d3.scale.linear()
          .range([height, 0])
          .domain([0, d3.max(data, function (item) {
              return item.Total;
            })]);

        var xAxis = d3.svg.axis()
          .scale(x)
          .orient("bottom");

        var yAxis = d3.svg.axis()
          .scale(y)
          .orient("left");

        var chart = d3.select(chartSvgSelector)
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
          .append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        chart.append("g")
          .attr("class", "x axis")
          .attr("transform", "translate(0," + height + ")")
          .call(xAxis);

        chart.append("g")
          .attr("class", "y axis")
          .call(yAxis);

        var yColor = d3.scale.linear()
          .range([255, 0])
          .domain([0, d3.max(data, function (item) {
              return item.Total;
            })]);

        chart.selectAll(".bar")
          .data(data)
          .enter().append("rect")
          .attr("class", "bar")
          .attr("x", function (d) {
            return x(d.Category);
          })
          .attr("y", function (d) {
            return y(d.Total);
          })
          .attr("height", function (d) {
            return height - y(d.Total);
          })
          .attr("width", x.rangeBand())
          .attr("style", function (item) {
            var r = Math.floor(yColor(item.Total));
            var g = Math.floor(yColor(item.Total)/2);
            var b = 128 + Math.floor(yColor(item.Total)/2);
            return "fill:rgb(" + r + "," + g + "," + b + ")";
            //return "fill:yellow";
          });

        /*
         var bar = chart.selectAll("g")
         .data(data)
         .enter().append("g")
         .attr("transform", function (d) {
         return "translate(" + x(d.Category) + ",0)";
         });
         
         bar.append("rect")
         .attr("y", function (d) {
         return y(d.Total);
         })
         .attr("height", function (d) {
         return height - y(d.Total);
         })
         .attr("width", x.rangeBand());
         
         bar.append("text")
         .attr("x", x.rangeBand() / 2)
         .attr("y", function (d) {
         return y(d.Total) + 3;
         })
         .attr("dy", ".75em")
         .text(function (d) {
         return d.Total;
         });*/
      }
    };
</script>