<form id="criteriaForm">
    <p id ="dataLoadingPlaceholder">Loading Data, please wait ...</p>
    <div class="input-group input-group-sm">
        <span class="input-group-addon"><span class="glyphicon glyphicon-book"></span></span>
        <input type="text" class="form-control" id="topicsPath" placeholder="categories" aria-describedby="sizing-addon3">
    </div>

    <div class="checkbox pull-right">
        <label>
            <input type="checkbox" id="topicsPathIsRelative"> Use Relative Path Mapping
        </label>
    </div><br/><br/>
    <div class="input-group input-group-sm">
        <span class="input-group-addon"><span class="glyphicon glyphicon-tags"></span></span>
        <select class="form-control" id="topicsDropdown" aria-describedby="sizing-addon3">
        </select>
    </div><br/>
    <div class="clearfix btn-group pull-right" role="group" aria-label="...">
        <button id="criteriaApply" type="button" class="btn btn-sm btn-default"> <span class="glyphicon glyphicon-floppy-saved" aria-hidden="true"></span> </button>
        <button id="criteriaReset" type="button" class="btn btn-sm btn-default"> <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> </button>
    </div>
</form>
<script type="text/javascript">

    var ConfigHandler = {
      loadConfigData: function (dataUrl) {
        $.ajax({
          url: dataUrl,
          type: "GET",
          success: function (data) {
            $('#dataLoadingPlaceholder').html('');

            $('#topicsPathIsRelative').prop('checked', data.topicsPathIsRelative);
            $('#topicsPath').val(data.topicsPath);

            ConfigHandler.loadTopics(dataUrl + '/topics', data.defaultTopic);

            $("#criteriaForm").show();
          },
          error: function (xhr, ajaxOptions, thrownError) {
            $('#dataLoadingPlaceholder').html("error: " + thrownError);
          },
          complete: function () {

          }
        });
      },
      loadTopics: function (dataUrl, defaultTopic){
          $.ajax({
          url: dataUrl,
          type: "GET",
          success: function (data) {
            // Populate dropdown
            $.each(data, function(index, item){
                //defaultTopic
               var option = $('<option>', {value: item.folder})
                 .html(item.name); 
               if (item.id === defaultTopic){
                   option.attr('selected','selected');
               }
               $('#topicsDropdown').append(option);
            });
          },
          error: function (xhr, ajaxOptions, thrownError) {
            alert("Cannot load topics: " + thrownError);
          },
          complete: function () {

          }
        });
      }
    };

    $(document).ready(function () {
      $("#criteriaForm").hide();
      var dataUrl = "{{dataUrl}}";
      ConfigHandler.loadConfigData(dataUrl);
    });
</script>